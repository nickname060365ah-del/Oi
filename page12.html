<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>แจกคอมมาน — By Pain</title>
<style>
:root{
  --bg:#0e0e0e; --panel:#0f0f0f; --card:#111213; --line:#222;
  --muted:#9aa0a6; --accent:#4da3ff; --accent-2:#2b86ff; --white:#fff; --press:#232428;
  --transition:.26s cubic-bezier(.2,.9,.2,1); --hero-pad:20px;
}

/* base */
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--white);font-family:Inter,system-ui,"Segoe UI",Tahoma,Arial,sans-serif;-webkit-font-smoothing:antialiased}
a{color:inherit;text-decoration:none}
button{font:inherit;background:transparent;border:0;color:inherit;cursor:pointer}
* { -webkit-tap-highlight-color: transparent; }

/* topbar */
.topbar{position:sticky;top:0;z-index:60;background:var(--panel);border-bottom:1px solid var(--line);display:flex;align-items:center;gap:12px;padding:12px 14px}
.hamb{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.hamb svg{width:22px;height:22px;fill:var(--white)}
.brand{font-weight:800;font-size:22px;color:var(--accent);margin-left:6px}
.spacer{flex:1}

/* layout */
.container{display:flex;min-height:calc(100vh - 64px);position:relative;padding-bottom:40px}

/* overlay + sidebar */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);opacity:0;pointer-events:none;transition:opacity .22s;z-index:65}
.overlay.show{opacity:1;pointer-events:auto}
.sidebar{position:fixed;left:-120%;top:0;height:100%;width:86vw;max-width:420px;background:var(--panel);box-shadow:2px 0 40px rgba(0,0,0,.6);z-index:70;padding:20px;transition:left var(--transition);overflow:auto;border-right:1px solid var(--line);border-radius:0 12px 12px 0}
.sidebar.open{left:0}

/* content */
.content{flex:1;padding:22px 16px;max-width:1100px;margin:0 auto}
.hero{padding:calc(var(--hero-pad) + 2px);border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);margin-bottom:12px;display:block}
.hero h1{font-size: clamp(26px, 6vw, 34px);line-height:1.02;margin:0 0 8px;color:var(--white);font-weight:700;text-align:left;}
.hero p{color:var(--muted);margin:0 0 12px;max-width:820px;text-align:left;font-size:15px;line-height:1.5;opacity:.95}

/* toolbar */
.tool-row{display:flex;gap:10px;align-items:center;margin:8px 0 18px;flex-wrap:wrap}
.search{display:flex;align-items:center;background:var(--card);padding:8px 10px;border-radius:12px;border:1px solid var(--line);min-width:120px;flex:1}
.search input{background:transparent;border:0;color:var(--white);width:100%;font-size:15px}
.select{background:var(--card);padding:8px 12px;border-radius:12px;border:1px solid var(--line);min-width:120px;color:var(--muted)}

/* download button (icon + full-fill press) */
.download-btn {
  background: linear-gradient(180deg, var(--accent), var(--accent-2));
  color: white;
  border-radius: 14px;
  padding: 12px 18px;
  font-weight: 600;
  transition: transform .12s, box-shadow .18s, opacity .12s;
  position: relative;
  overflow: hidden;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:140px;
  gap:10px;
  box-shadow: 0 10px 28px rgba(43,134,255,0.14);
  border:1px solid rgba(255,255,255,0.03);
}
.download-btn .ico { width:18px; height:18px; display:inline-block; opacity:.98; }
.download-btn:active { transform: translateY(1px) scale(.99); }
.download-btn.fill {
  box-shadow: 0 18px 40px rgba(43,134,255,0.22);
  transform: translateY(-2px);
  background: linear-gradient(90deg, var(--accent), #1990ff);
}

/* copy all button (full style) */
.btn.ghost{background:transparent;border:1px solid var(--line);color:var(--white);padding:10px 14px;border-radius:12px;display:inline-flex;align-items:center;gap:8px}
.btn.ghost.fill {
  background: rgba(255,255,255,0.03);
  border-color: rgba(255,255,255,0.06);
  box-shadow: 0 8px 24px rgba(0,0,0,0.6);
  transform: translateY(-2px);
}

/* copy-section small button */
.copy-section-btn { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); color:var(--white); border-radius:10px; padding:8px 10px; font-weight:600; border:1px solid rgba(255,255,255,0.03); cursor:pointer; margin-left:10px; display:inline-flex; align-items:center; gap:8px; min-width:110px; position:relative; overflow:hidden; }
.copy-section-btn.fill { background: linear-gradient(90deg, rgba(77,163,255,0.12), rgba(43,134,255,0.12)); border-color: rgba(77,163,255,0.18); box-shadow: 0 8px 20px rgba(43,134,255,0.08); transform:translateY(-2px); }

/* codewrap highlight (full box) */
.codewrap {
  background:#060606;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);overflow:auto;transition:box-shadow .18s, background .16s, border .16s;
}
.codewrap.copy-highlight {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(77,163,255,0.14);
  box-shadow: 0 12px 40px rgba(12,20,30,0.6);
}

/* pre styling */
pre.cmd{margin:0;color:#e6eef8;background:transparent;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Roboto Mono, "Courier New",monospace;font-size:14px;line-height:1.5;white-space:pre-wrap;word-break:break-word}

/* small click press on pre -> subtle */
pre.cmd.press-anim { transform: translateY(0); transition: transform .12s; }

/* bottom extra actions */
.bottom-actions{display:flex;gap:12px;justify-content:center;margin:18px 0 6px;align-items:center}
.extra-btn{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid var(--line);padding:10px 14px;border-radius:12px;cursor:pointer;display:inline-flex;align-items:center;gap:10px;font-weight:700}
.extra-btn.fill{background:linear-gradient(90deg, rgba(77,163,255,0.12), rgba(43,134,255,0.12));box-shadow:0 10px 30px rgba(43,134,255,0.08);border-color:rgba(77,163,255,0.14);transform:translateY(-2px)}

/* icon */
.ico { width:16px;height:16px;display:inline-block;vertical-align:middle; }

/* subtle animations */
.fade-in-up { animation: fadeUp .45s ease both; }
@keyframes fadeUp { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

/* footer */
footer{padding:22px;text-align:center;color:var(--muted);border-top:1px solid var(--line);margin-top:18px}

/* remove outlines on focus */
:focus{outline:none}
</style>
</head>
<body>

<!-- topbar -->
<div class="topbar">
  <button class="hamb" id="hambBtn" aria-label="เปิดเมนู">
    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 6h18v2H3zM3 11h18v2H3zM3 16h18v2H3z"/></svg>
  </button>
  <div class="brand">MC Command</div>
  <div class="spacer"></div>
</div>

<div class="container">
  <main class="content" id="mainContent" role="main">
    <section class="hero" aria-labelledby="heroTitle">
      <div class="hero-inner">
        <h1 id="heroTitle">แจกคอมมานซื้อของ — By Pain</h1>
        <p>รวมคำสั่ง Minecraft Bedrock (แจกระบบซื้อของใน NPC) — จัดเป็นหมวด อ่านง่าย ก๊อปได้จริง</p>
      </div>
    </section>

    <div class="tool-row">
      <div class="search">
        <input id="searchInput" placeholder="ค้นหา... (เช่น give, tag, playsound)" />
      </div>

      <select id="filterSelect" class="select" aria-label="กรองหมวด">
        <option value="all">ทั้งหมด</option>
        <option value="chat">คำสั่งช่องแชท</option>
        <option value="cmdblock">คำสั่งคอมมานบล็อก</option>
        <option value="npc">คำสั่ง NPC</option>
      </select>

      <button id="downloadBtn" class="download-btn" aria-label="ดาวน์โหลด">
        <!-- เปลี่ยนเป็นไอคอน + คำสั่งสั้น (ดูดี) -->
        <svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 3v10.5l4-4V21H8V9.5l4 4V3z"/></svg>
        ดาวน์โหลด
        <span class="flash" aria-hidden="true"></span>
      </button>

      <button id="copyAllBtn" class="btn ghost" aria-label="คัดลอกทั้งหมด">
        <svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zM19 5H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
        คัดลอกทั้งหมด
      </button>
    </div>

    <!-- content -->
    <section class="section" data-cat="chat" id="sec-chat">
      <div class="heading-row">
        <h3>คำสั่งในช่องแชท</h3>
        <button class="copy-section-btn" data-target="chatCommands" aria-label="คัดลอกหมวดแชท">
          <svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zM19 5H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
          คัดลอก
        </button>
      </div>
      <p class="lead">แนะนำก๊อปทีละคำสั่งแล้ววาง</p>
      <div class="codewrap fade-in-up">
<pre id="chatCommands" class="cmd">
1. /give @s command_block
2. /give @s spawn_egg 1 51
3. /gamerule commandblockoutput false
4. /gamerule sendcommandfeedback false
5. /tickingarea add circle ~~~ 4 t
6. /scoreboard objectives add m dummy

/tag @n[type=npc] add b
</pre>
      </div>
    </section>

    <section class="section" data-cat="cmdblock" id="sec-cmd">
      <div class="heading-row">
        <h3>คำสั่งในคอมมานบล็อก</h3>
        <button class="copy-section-btn" data-target="cmdBlockCommands" aria-label="คัดลอกหมวดคอมมานบล็อก">คัดลอก</button>
      </div>
      <div class="codewrap fade-in-up">
<pre id="cmdBlockCommands" class="cmd">
1. dialogue open @e[type=npc,tag=b] @a[tag=b]

2. scoreboard players add @a m 0

3. execute as @a at @s run titleraw @s actionbar {"rawtext":[{"text":"§6Money  §r : "},{"score":{"name":"@s","objective":"m"}}]}
</pre>
      </div>
    </section>

    <section class="section" data-cat="npc" id="sec-npc">
      <div class="heading-row">
        <h3>คำสั่งใน NPC (ตัวหลัก & ตัวซื้อ)</h3>
        <button class="copy-section-btn" data-target="npcBuy" aria-label="คัดลอกหมวด NPC">คัดลอก</button>
      </div>
      <div class="codewrap fade-in-up">
<pre id="npcBuy" class="cmd">
1. playsound mob.villager.no @initiator[scores={m=..19}]
playsound note.harp @initiator[scores={m=..19}]
tellraw @initiator[scores={m=..19}] {"rawtext":[{"text":" §eคนขายของ§r: §cซื้อไม่สำเร็จ§r"}]}
playsound mob.villager.yes @initiator[scores={m=20..}]
playsound note.bell @initiator[scores={m=20..}]
tellraw @initiator[scores={m=20..}] {"rawtext":[{"text":" §eคนขายของ§r: §aซื้อสำเร็จ§r"}]}
give @initiator[scores={m=20..}] wooden_sword 1
scoreboard players remove @initiator[scores={m=20..}] m 20

2. /tag @initiator remove b
(ตัวซื้อของ)
</pre>
      </div>
    </section>

    <!-- bottom extra buttons -->
    <div class="bottom-actions">
      <button id="extraCopyBtn" class="extra-btn" title="คัดลอกคำสั่งทั้งหมด (สะอาด)">
        <svg class="ico" viewBox="0 0 24 24"><path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zM19 5H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
        คัดลอกคำสั่งทั้งหมด
      </button>

      <button id="extraDownloadBtn" class="extra-btn" title="ดาวน์โหลดคำสั่งทั้งหมด (สะอาด)">
        <svg class="ico" viewBox="0 0 24 24"><path fill="currentColor" d="M12 3v10.5l4-4V21H8V9.5l4 4V3z"/></svg>
        ดาวน์โหลดคำสั่งทั้งหมด
      </button>
    </div>

    <footer>© MC Command Bedrock — By Pain</footer>
  </main>
</div>

<script>
(() => {
  // elements
  const hamb = document.getElementById('hambBtn');
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  const closeBtn = document.getElementById('closeBtn');
  const searchInput = document.getElementById('searchInput');
  const filterSelect = document.getElementById('filterSelect');
  const downloadBtn = document.getElementById('downloadBtn');
  const copyAllBtn = document.getElementById('copyAllBtn');
  const extraCopyBtn = document.getElementById('extraCopyBtn');
  const extraDownloadBtn = document.getElementById('extraDownloadBtn');

  // helper: safe get
  function $(id){ return document.getElementById(id); }

  // hide header image placeholder if any
  const headerImg = $('headerImg');
  if(headerImg){ headerImg.style.display='none'; setTimeout(()=>headerImg.remove(),80); }

  // search & filter (same as before)
  const sections = Array.from(document.querySelectorAll('section.section'));
  function applyFilter(){
    const q = (searchInput && searchInput.value || '').trim().toLowerCase();
    const cat = (filterSelect && filterSelect.value) || 'all';
    sections.forEach(sec=>{
      const catMatch = (cat === 'all') || (sec.dataset.cat === cat);
      const text = (sec.innerText || '').toLowerCase();
      const qMatch = q === '' || text.indexOf(q) !== -1;
      const show = catMatch && qMatch;
      sec.style.display = show ? '' : 'none';
    });
  }
  if(searchInput) searchInput.addEventListener('input', applyFilter);
  if(filterSelect) filterSelect.addEventListener('change', applyFilter);
  applyFilter();

  /* ======= core: extract clean commands (same reliable version) ======= */
  function cleanLineCandidate(line){
    if(!line) return '';
    let ln = line.trim();
    if(!ln) return '';

    ln = ln.replace(/^[\s]*\d+[\.\)]\s*/, ''); // remove leading numbers
    ln = ln.replace(/^[\s]*[\-\*\•]\s*/, ''); // bullets
    ln = ln.replace(/\s+\(\s*.*$/,'');      // trailing ( ... )
    ln = ln.replace(/\s+—\s+.*$/,'');       // trailing — ...
    ln = ln.replace(/\s+\/\/\s+.*$/,'');    // trailing // ...
    ln = ln.replace(/\s*\/\/.*$/,'');       // trailing //comments

    ln = ln.trim();
    if(!ln) return '';
    const firstChar = ln.charAt(0);
    if(firstChar === '{' || firstChar === '[' || firstChar === '"' ) return '';

    let token = ln.split(/\s+/)[0];
    token = token.replace(/^\//, '');
    if(/[ก-๙]/.test(token)) return '';
    if(!/^[A-Za-z_\-:][A-Za-z0-9_\-:]*$/.test(token)) return '';

    if(!ln.startsWith('/')) ln = '/' + ln;
    return ln;
  }

  function extractCommandsFromText(text){
    if(!text) return [];
    const lines = text.split(/\r?\n/);
    const cmds = [];
    for(let ln of lines){
      const c = cleanLineCandidate(ln);
      if(c) cmds.push(c);
    }
    return cmds;
  }

  function collectVisibleCommands(){
    const visiblePreTexts = Array.from(document.querySelectorAll('section.section'))
      .filter(s => s.style.display !== 'none')
      .map(s => {
        const pre = s.querySelector('pre.cmd');
        return pre ? pre.innerText : '';
      }).filter(Boolean);

    const allCmds = [];
    visiblePreTexts.forEach(t => {
      const arr = extractCommandsFromText(t);
      arr.forEach(x => allCmds.push(x));
    });
    return allCmds.join("\n");
  }

  function collectCommandsFromPreId(id){
    const pre = document.getElementById(id);
    if(!pre) return '';
    return extractCommandsFromText(pre.innerText).join('\n');
  }

  /* ====== UX helpers: box highlight + button fill ====== */
  function highlightCodewrap(preEl, duration=1200){
    if(!preEl) return;
    const wrap = preEl.closest('.codewrap') || preEl.parentElement;
    if(!wrap) return;
    wrap.classList.add('copy-highlight');
    setTimeout(()=> wrap.classList.remove('copy-highlight'), duration);
  }

  function highlightAllVisible(duration=1200){
    const visibleWraps = Array.from(document.querySelectorAll('section.section'))
      .filter(s => s.style.display !== 'none')
      .map(s => s.querySelector('.codewrap'))
      .filter(Boolean);
    visibleWraps.forEach(w => {
      w.classList.add('copy-highlight');
    });
    setTimeout(()=> visibleWraps.forEach(w => w.classList.remove('copy-highlight')), duration);
  }

  function btnFill(btn, duration=1200){
    if(!btn) return;
    btn.classList.add('fill');
    setTimeout(()=> btn.classList.remove('fill'), duration);
  }

  function withSuccessState(btn){
    if(!btn) return;
    btn.classList.add('success');
    const orig = btn.innerHTML;
    try{
      btn.innerHTML = '<svg class="ico" viewBox="0 0 24 24" style="width:16px;height:16px;opacity:.95"><path fill="currentColor" d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>เรียบร้อย';
    }catch(e){
      btn.textContent = 'เรียบร้อย';
    }
    setTimeout(()=> { btn.classList.remove('success'); btn.innerHTML = orig; }, 1100);
  }

  /* ====== Button behaviors ====== */

  // download button (fill effect + download)
  if(downloadBtn){
    downloadBtn.addEventListener('click', (e)=>{
      const text = collectVisibleCommands();
      if(!text){ alert('ไม่มีคำสั่งที่มองเห็นเพื่อดาวน์โหลด'); return; }

      // full button fill + highlight all code blocks
      btnFill(downloadBtn, 1000);
      highlightAllVisible(1000);

      const blob = new Blob([text], {type: 'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'mc-commands-by-pain.txt';
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=> URL.revokeObjectURL(url), 1500);
    });
  }

  // copy all visible
  if(copyAllBtn){
    copyAllBtn.addEventListener('click', async ()=>{
      const text = collectVisibleCommands();
      if(!text){ alert('ไม่มีคำสั่งที่มองเห็นให้คัดลอก'); return; }
      try{
        await navigator.clipboard.writeText(text);
        // full button fill + highlight all codeblocks
        btnFill(copyAllBtn, 1100);
        highlightAllVisible(1100);
        withSuccessState(copyAllBtn);
      }catch(e){
        alert('คัดลอกไม่สำเร็จ — เบราเซอร์นี้ไม่รองรับการคัดลอกอัตโนมัติ');
      }
    });
  }

  // extra bottom buttons
  if(extraCopyBtn){
    extraCopyBtn.addEventListener('click', async ()=>{
      const text = collectVisibleCommands();
      if(!text){ alert('ไม่มีคำสั่งที่มองเห็นให้คัดลอก'); return; }
      try{
        await navigator.clipboard.writeText(text);
        btnFill(extraCopyBtn,1100);
        highlightAllVisible(1100);
        withSuccessState(extraCopyBtn);
      }catch(e){
        alert('คัดลอกไม่สำเร็จ — เบราเซอร์นี้ไม่รองรับการคัดลอกอัตโนมัติ');
      }
    });
  }
  if(extraDownloadBtn){
    extraDownloadBtn.addEventListener('click', (e)=>{
      const text = collectVisibleCommands();
      if(!text){ alert('ไม่มีคำสั่งที่มองเห็นเพื่อดาวน์โหลด'); return; }
      btnFill(extraDownloadBtn,1000);
      highlightAllVisible(1000);
      const blob = new Blob([text], {type: 'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'mc-commands-by-pain.txt';
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=> URL.revokeObjectURL(url), 1500);
    });
  }

  // per-section copy buttons
  document.querySelectorAll('.copy-section-btn').forEach(btn=>{
    btn.addEventListener('click', async (ev)=>{
      const targetId = btn.getAttribute('data-target');
      const text = collectCommandsFromPreId(targetId);
      if(!text){ alert('หมวดนี้ไม่มีคำสั่งแบบที่คัดได้'); return; }

      // highlight that specific block and show button fill
      const pre = document.getElementById(targetId);
      highlightCodewrap(pre, 1100);
      btnFill(btn, 1100);

      try{
        await navigator.clipboard.writeText(text);
        withSuccessState(btn);
      }catch(e){
        alert('คัดลอกไม่สำเร็จ — เบราเซอร์นี้ไม่รองรับการคัดลอกอัตโนมัติ');
      }
    });
  });

  // small click feedback for pre blocks (transient)
  document.querySelectorAll('pre.cmd').forEach(pre=>{
    pre.addEventListener('click', ()=> {
      pre.classList.add('press-anim');
      setTimeout(()=> pre.classList.remove('press-anim'), 220);
    });
  });

})();
</script>
</body>
  </html>
